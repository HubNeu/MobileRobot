$(document).ready((function(){$("#sidenav-toggle-btn").on("click",(function(){$(document.body).toggleClass("sidenav-active")})),$("#sidenav-overlay").on("click",(function(){$(document.body).removeClass("sidenav-active")})),$("#topnav-tasks-dropdown").on("mouseover",(function(){$(this).addClass("topnav-dropdown-active")})).on("mouseout",(function(){$(this).removeClass("topnav-dropdown-active")}));var e=$("#sidenav");e.on("mouseover",(function(){e.addClass("sidenav-hover")})),e.on("mouseout",(function(){e.removeClass("sidenav-hover")})),(new BreakpointDetector).md({onIncrease:function(){},onDecrease:function(){$(document.body).removeClass("sidenav-active")},fire:!0}).lg({onIncrease:function(){$(document.body).addClass("sidenav-active")},onDecrease:function(){$(document.body).removeClass("sidenav-active")},fire:!0}),$(document.body).removeClass("init"),new ProjectSelectionModal("select-project-link","projects-data",{name:"Nazwa projektu",status:"Status",statusWidth:100})}));class Alert{constructor(e=!0,t={title:"Alert title",message:"Alert message"}){this.alert=$("<div/>").addClass("a-alert").attr("role","alert"),this.container=$("<div/>").addClass("a-container").appendTo(this.alert),this.header=$("<div/>").addClass("a-header").appendTo(this.container),this.title=$("<div/>").addClass("a-title").prependTo(this.header),this.body=$("<div/>").addClass("a-body").appendTo(this.container),this.footer=$("<div/>").addClass("a-footer").appendTo(this.container),$("<i/>").addClass("icon-cancel a-header-close-btn").on("click",()=>{this.hide()}).appendTo(this.header),$("<button/>").addClass("k-btn").attr("role","button").text("Ok").css("width","80px").on("click",()=>{this.hide()}).appendTo(this.footer),this.setTitle(t.title).setMessage(t.message),e&&this.show()}setTitle(e){return this.title.text(e),this}setMessage(e){return this.body.empty().append(e),this}info(){return $("<i/>").addClass("a-icon-info icon-info").prependTo(this.header),this}warning(){return $("<i/>").addClass("a-icon-warning icon-warning").prependTo(this.header),this}ok(){return $("<i/>").addClass("a-icon-success icon-checkmark").prependTo(this.header),this}error(){return $("<i/>").addClass("a-icon-error icon-cross").prependTo(this.header),this}option(e){return $("<i/>").addClass("a-icon-warning icon-warning").prependTo(this.header),this.footer.empty(),$("<button/>").addClass("k-btn").attr("role","button").text("Tak").css("margin-right","0.5rem").css("width","80px").on("click",()=>{e()}).appendTo(this.footer),$("<button/>").addClass("k-btn k-btn-light").attr("role","button").text("Anuluj").css("width","80px").on("click",()=>{this.hide()}).appendTo(this.footer),this}show(){return this.alert.appendTo($(document.body)),this}hide(){this.alert.detach()}setTrigger(e){return $("#"+e).on("click",()=>{this.show()}),this}}class BreakpointDetector{constructor(){this.smMedia=window.matchMedia("(min-width: 576px)"),this.mdMedia=window.matchMedia("(min-width: 768px)"),this.lgMedia=window.matchMedia("(min-width: 992px)"),this.xlMedia=window.matchMedia("(min-width: 1200px)")}sm(e){var t=t=>{t.matches?e.onIncrease():e.onDecrease()};return this.smMedia.addListener(t),e.fire&&t(this.smMedia),this}md(e){var t=t=>{t.matches?e.onIncrease():e.onDecrease()};return this.mdMedia.addListener(t),e.fire&&t(this.mdMedia),this}lg(e){var t=t=>{t.matches?e.onIncrease():e.onDecrease()};return this.lgMedia.addListener(t),e.fire&&t(this.lgMedia),this}xl(e){var t=t=>{t.matches?e.onIncrease():e.onDecrease()};return this.xlMedia.addListener(t),e.fire&&t(this.xlMedia),this}}function dragAndDrop(e,t){let s=0;const a=e.find(".files-container"),o=e.find('input[type="file"]');a.find(".add-file").text(t),$(document).bind({dragenter:()=>{s++,e.addClass("dragover")},dragleave:()=>{s--,0==s&&e.removeClass("dragover")},drop:()=>{e.removeClass("dragover"),s=0},dragover:!1}),o.on("change",(function(){const e=$(this).prop("files");if(a.empty(),0!==e.length)for(let t=0;t<e.length;t++)a.append("<div class='file'>"+e[t].name+"</div>");else a.append($("<span/>").addClass("add-file").text(t))})),e.scroll(()=>{o.css("top",e.scrollTop())})}function fileListEdit(e,t,s,a,o){if(t){const i=[];s.find("button[data-download-button]").click(()=>{let e="../connection/database/query/downloadFiles.php?zlecenie="+encodeURIComponent(o);i.forEach((t,s)=>{e+="&f"+s+"="+encodeURIComponent(t)}),window.location.href=e}),a&&s.find("button[data-delete-button]").click(()=>{let e="Czy napewno chcesz usunąć te pliki?<br><br>",t="../connection/database/query/deleteFiles.php?zlecenie="+encodeURIComponent(o);i.forEach((s,a)=>{e+="<b>"+s+"</b><br>",t+="&f"+a+"="+encodeURIComponent(s)}),e+="<br>Operacja jest nieodwracalna!",(new Alert).setTitle("Usuwanie plików ("+i.length+")").setMessage(e).option((function(){window.location.href=t}))}),t.forEach(t=>{const n={selected:!1},l=$("<a/>").attr("target","_blank").attr("href","../connection/database/query/downloadFiles.php?zlecenie="+o+"&f0="+encodeURIComponent(t)).append($("<i/>").addClass("k-files-list-action-icon icon-arrow-down2")),d=$("<div/>").addClass("k-row-tick-wrapper").append($("<span/>").addClass("k-files-list-row-tick")).click(()=>{n.selected?(n.dom.removeClass("selected"),n.dom.addClass("no-hover"),i.splice(i.indexOf(t),1)):(n.dom.addClass("selected"),n.dom.removeClass("no-hover"),i.push(t)),i.length>0?s.show().find(".files-count").text(i.length):s.hide(),n.selected=!n.selected}),r=$("<span/>").addClass("k-files-list-actions").append(l);if(a){const e=$("<a/>").append($("<i/>").addClass("k-files-list-action-icon icon-bin")).click(()=>{(new Alert).setTitle("Usuwanie pliku").setMessage("Czy napewno chcesz usunąć plik <b>"+t+"</b> ? Operacja jest nieodwracalna!").option((function(){window.location.href="../connection/database/query/deleteFiles.php?zlecenie="+encodeURIComponent(o)+"&f0="+encodeURIComponent(t)}))});r.append(e)}r.append(d),n.dom=$("<div/>").addClass("k-files-list-row").append($("<span/>").text(t)).append(r).appendTo(e),d.on("mouseleave",()=>n.dom.removeClass("no-hover"))})}else $("<div/>").addClass("k-files-list-row no-files").text("Brak").appendTo(e)}function fileListInfo(e,t,s,a){if(t){s.show();const o=[],i=s.find("button[data-download-button]").click(()=>{let e="../connection/database/query/downloadFiles.php?zlecenie="+encodeURIComponent(a);o.forEach((t,s)=>{e+="&f"+s+"="+encodeURIComponent(t)}),window.location.href=e});s.find("button[data-download-all-button]").click(()=>{let e="../connection/database/query/downloadFiles.php?zlecenie="+encodeURIComponent(a);t.forEach((t,s)=>{e+="&f"+s+"="+encodeURIComponent(t)}),window.location.href=e}),t.forEach(t=>{const s={selected:!1},n=$("<a/>").attr("target","_blank").attr("href","../connection/database/query/downloadFiles.php?zlecenie="+encodeURIComponent(a)+"&f0="+encodeURIComponent(t)).append($("<i/>").addClass("k-files-list-action-icon icon-arrow-down2").css("margin","0")),l=$("<div/>").addClass("k-row-tick-wrapper").append($("<span/>").addClass("k-files-list-row-tick")).click(()=>{s.selected?(s.dom.removeClass("selected"),s.dom.addClass("no-hover"),o.splice(o.indexOf(t),1)):(s.dom.addClass("selected"),s.dom.removeClass("no-hover"),o.push(t)),o.length>0?i.show().find(".files-count").text(o.length):i.hide(),s.selected=!s.selected}),d=$("<span/>").addClass("k-files-list-actions").append(n).append(l);s.dom=$("<div/>").addClass("k-files-list-row").append($("<span/>").text(t)).append(d).appendTo(e),l.on("mouseleave",e=>s.dom.removeClass("no-hover"))})}else $("<div/>").addClass("k-files-list-row no-files").text("Brak").appendTo(e)}class k_Select{constructor({selectDiv:e,selectName:t,placeholder:s,searchField:a,onShow:o,onChange:i,onHide:n,options:l,multiple:d=!1,hideOnSelect:r=!0,showFooter:c=!0,showCounter:h=!0,showOptionOnSelect:p=!1,visible:u=!1}={}){if(this.$selectDiv=$(e),this.placeholderText=s,this.multiple=d,this.hideOnSelect=r,this.showOptionOnSelect=p,this.onShow=o,this.onChange=i,this.onHide=n,this.showCounter=h,this.options=[],this.selectedOptions=[],this.visible=u,!this.$selectDiv.is("div"))throw new Error("<div> expected.");t&&"string"==typeof t&&(this.$select=$("<select/>").attr("name",t).insertAfter(this.$selectDiv).hide(),$("<option/>").attr("selected","selected").attr("disabled","disabled").attr("value","").appendTo(this.$select),d&&this.$select.attr("multiple","multiple")),this.$selectDiv.addClass("k-select");var f=$("<div/>").addClass("k-select-bar").appendTo(this.$selectDiv);this.$counter=$("<div/>").addClass("k-select-counter").hide().appendTo(f),this.placeholderText&&(this.$placeholder=$("<span/>").addClass("k-select-placeholder").text(this.placeholderText).appendTo(f)),d?p&&(this.$selectDiv.addClass("k-select-multiple"),this.$optionBoxes=$("<span/>").addClass("k-select-option-boxes").appendTo(f)):p&&!this.$placeholder&&(this.$placeholder=$("<span/>").addClass("k-select-placeholder").text(this.placeholderText).appendTo(f)),$("<span/>").addClass("k-select-arrow").appendTo(f);var g=$("<div/>").addClass("k-select-wrapper").appendTo(this.$selectDiv),w=$("<div/>").addClass("k-select-container").appendTo(g);if(this.$body=$("<div/>").addClass("k-select-body").appendTo(w),c&&(this.$footer=$("<div/>").addClass("k-select-footer").appendTo(w),$("<button/>").attr("type","button").addClass("k-btn k-btn-light").text("Wyczyść").appendTo(this.$footer).on("click",()=>this.deselectAll()),$("<button/>").attr("type","button").addClass("k-btn").text("Zamknij").appendTo(this.$footer).on("click",()=>this.hide())),$(document).on("click",e=>{var t=0==$(e.target).closest(w).length,s=0!=$(e.target).closest(f).length;t&&(s?this.visible?(this.hide(),this.visible=!1):(this.show(),this.visible=!0):(this.hide(),this.visible=!1))}),a&&"string"==typeof a){var C=$("<div/>").addClass("k-select-header").prependTo(w),k=this;$("<input/>").addClass("k-form-control").attr("type","search").attr("placeholder",a).appendTo(C).on("input paste keyup",(function(){var e=$(this).val().toLowerCase();$(k.options).filter((function(){this.sdom.toggle(this.text.toLowerCase().indexOf(e)>-1)}))}))}l&&this.setOptions(l)}setOptions(e){if(!(e instanceof Array))throw new Error("Array expected, get "+typeof e);return 0==e.length||(this.options=[],e.forEach(e=>{const t={sdom:$("<span/>").addClass("k-select-option").appendTo(this.$body),click:function(){this.sdom.trigger("click")},select:function(){this.selected||this.click()},deselect:function(){this.selected&&this.click()}};if("string"==typeof e)t.value=e.toLowerCase(),t.text=e,t.selected=!1,t.disabled=!1;else{const{value:s,text:a=s,selected:o=!1,disabled:i=!1}=e;t.value=s,t.text=a,t.selected=o,t.disabled=i}if(this.$select){const e=$("<option/>").attr("value",t.value).text(t.text).appendTo(this.$select);t.selected&&e.attr("selected","selected"),t.disabled&&e.attr("disabled","disabled"),t.odom=e}t.sdom.append($("<span/>").text(t.text)).append($("<span/>").addClass("k-select-tick")),t.disabled&&t.sdom.addClass("option-disabled"),t.sdom.on("click",()=>{if(!t.disabled){if(this.multiple)t.selected?(this.selectedOptions.splice(this.selectedOptions.indexOf(t),1),t.sdom.addClass("no-hover").removeClass("option-selected"),t.optionBox&&(t.optionBox.remove(),delete t.optionBox)):(this.selectedOptions.push(t),t.sdom.addClass("option-selected").removeClass("no-hover"),this.showOptionOnSelect&&(t.optionBox=$("<span/>").addClass("k-select-option-box").append($("<span/>").addClass("k-option-box-text").text(t.text)).appendTo(this.$optionBoxes).on("click",e=>e.stopPropagation()),$("<i/>").addClass("k-option-box-close icon-cross").appendTo(t.optionBox).on("click",e=>{t.deselect(),e.stopPropagation()}))),this.selectedOptions.length>0?this.showCounter&&this.$counter.text(this.selectedOptions.length).show():(this.$counter.empty().hide(),this.$placeholder&&this.$placeholder.empty().text(this.placeholderText));else{if(this.selectedOptions.length>=1){var e=this.selectedOptions[0],s=t.sdom!=e.sdom;s&&(this.selectedOptions=[],e.sdom.removeClass("option-selected"),e.selected=!1,e.odom&&e.odom.removeAttr("selected"))}t.selected?(this.selectedOptions=[],t.sdom.addClass("no-hover").removeClass("option-selected"),this.$placeholder&&this.$placeholder.empty().text(this.placeholderText)):(this.selectedOptions.push(t),t.sdom.addClass("option-selected").removeClass("no-hover"),this.showOptionOnSelect?this.placeholderText?this.$placeholder.empty().text(this.placeholderText+": "+t.text):this.$placeholder.empty().text(t.text):this.$placeholder&&this.$placeholder.empty().text(this.placeholderText))}t.selected=!t.selected,t.odom&&(t.odom.removeAttr("selected"),t.selected&&t.odom.attr("selected","selected")),this.hideOnSelect&&this.hide(),this.onChange&&(s&&this.onChange(e),this.onChange(t))}}).on("mouseleave",()=>$(this).removeClass("no-hover")).children().on("mouseleave",e=>e.stopPropagation()),this.options.push(t)}),this.options.forEach(e=>{e.selected&&(e.selected=!1,e.click())})),this}show(){return this.$selectDiv.addClass("k-select-active"),this.onShow&&this.onShow(),this.visible=!0,this}hide(){return this.$selectDiv.removeClass("k-select-active"),this.onHide&&this.onHide(),this.visible=!1,this}setCloseOnSelect(e){return this.hideOnSelect=e,this}setOnShow(e){return this.onShow=e,this}setOnChange(e){return this.onChange=e,this}setOnHide(e){return this.onHide=e,this}selectAll(){if(!this.multiple)throw new Error("Cannot select all options of single-select select box");this.options.forEach(e=>{e.select()})}deselectAll(){this.options.forEach(e=>{e.deselect()})}}class Modal{constructor(e){this.trigger=$("#"+e),this.modal=$("<div/>").addClass("m-modal hidden").attr("role","dialog"),this.container=$("<div/>").addClass("m-container").appendTo(this.modal),this.header=$("<div/>").addClass("m-header").appendTo(this.container),this.body=$("<div/>").addClass("m-body").appendTo(this.container),this.footer=$("<div/>").addClass("m-footer").appendTo(this.container),$("<i/>").addClass("icon-cancel m-header-close-btn").on("click",()=>{this.hide()}).appendTo(this.header),$("<button/>").addClass("k-btn").attr("role","button").text("Ok").on("click",()=>{this.hide()}).appendTo(this.footer),this.modal.on("mousedown",()=>{0===$(event.target).closest(this.container).length&&this.hide()}).appendTo($(document.body)),this.trigger.on("click",()=>{this.show()})}show(){this.modal.removeClass("hidden")}hide(){this.modal.addClass("hidden")}removeFooter(){this.footer.detach()}}class SearchModal extends Modal{constructor(e){super(e),this.pattern="*";var t=this;this.searchInput=$("<input/>").addClass("k-form-control").attr("type","search").attr("placeholder","Szukaj").prependTo(this.header).on("input paste keyup",(function(){var e=$(this).val().toLowerCase();t.body.find(".filterable").filter((function(){var s=$(this).find(t.pattern).first();$(this).toggle(s.text().toLowerCase().indexOf(e)>-1)}))}))}setPattern(e){this.pattern=e}setInputPlaceholder(e){this.searchInput.attr("placeholder",e)}}class ProjectSelectionModal extends SearchModal{constructor(e,t,s={name:"Name",status:"Status",statusWidth:100}){super(e),super.setPattern("a.project-name"),super.removeFooter();var a=$("<div/>").addClass("m-row header").appendTo(this.body);$("<div/>").addClass("m-col").text(s.name).appendTo(a),$("<div/>").addClass("m-col center no-flex").text(s.status).width(s.statusWidth).appendTo(a);var o=$("#"+t);o.find(".project").each((e,t)=>{var a=$(t),o=a.find(".project-name").first().text(),i=a.find(".project-link").first().text(),n=a.hasClass("project-active")?"m-status-active":"m-status-inactive",l=$("<div/>").addClass("m-row filterable").appendTo(this.body),d=$("<a/>").addClass("project-name").text(o).attr("href",i),r=$("<span/>").addClass(n);$("<div/>").addClass("m-col").append(d).appendTo(l),$("<div/>").addClass("m-col center no-flex").append(r).width(s.statusWidth).appendTo(l)}),o.remove()}}class MultiselectModal extends SearchModal{constructor(e,t={name:"Name",status:"Status",statusWidth:100}){super(e),super.setPattern(".project-name");var s=this.trigger.attr("data-select");if(!s)throw new Error("'data-select' attribute is not set for element '#"+this.trigger.attr("id")+"'");$("<button/>").addClass("k-btn k-btn-light").attr("role","button").text("Wyczyść").on("click",()=>{this.deselectAll()}).prependTo(this.footer),this.headerCheckbox=$("<div/>").addClass("m-checkbox").append($("<span/>").addClass("m-checkmark")).css("margin-left",".5rem"),this.headerCheckbox.on("click",()=>{this.headerCheckbox.hasClass("checked")?this.deselectAll():this.selectAll()});var a=$("<div/>").addClass("m-row header").appendTo(this.body);$("<div/>").addClass("m-col").text(t.name).appendTo(a),$("<div/>").addClass("m-col center no-flex").text(t.status).append(this.headerCheckbox).width(t.statusWidth).appendTo(a),this.select=$(s),this.select.children().each((e,s)=>{var a=$(s),o=$("<div/>").addClass("m-row filterable"),i=$("<div/>").addClass("m-checkbox").append($("<span/>").addClass("m-checkmark"));i.on("click",()=>{i.hasClass("checked")?(a.removeAttr("selected"),o.removeClass("selected")):(a.attr("selected","selected"),o.addClass("selected")),i.toggleClass("checked"),this.select.change(),this.refreshList()}),a.is(":selected")&&(o.addClass("selected"),i.addClass("checked")),$("<div/>").addClass("m-col project-name").text(a.text()).appendTo(o),$("<div/>").addClass("m-col center no-flex").append(i).width(t.statusWidth).appendTo(o),this.body.append(o)}),this.optionChecks=this.body.find(".filterable .m-checkbox"),this.refreshList()}getSelectedItems(){var e,t=[];return this.select.children().each((s,a)=>{(e=$(a)).attr("selected")&&t.push(e)}),$(t)}refreshList(){var e=this.getSelectedItems();this.trigger.empty(),$("<span/>").addClass("item").text("Uprawnienia").appendTo(this.trigger),e.each((e,t)=>{$("<span/>").addClass("item").text($(t).text()).appendTo(this.trigger)})}selectAll(){this.optionChecks.each((e,t)=>{$(t).hasClass("checked")||t.click()}),this.headerCheckbox.addClass("checked")}deselectAll(){this.body.find(".filterable .checked").each((e,t)=>{$(t).click()}),this.headerCheckbox.removeClass("checked")}}function expandableRows(e){const t=$(".k-table tbody tr .overflow-ellipsis");let s,a,o,i=!1;t.on("mouseup",(function(n){if(i&&Math.abs(n.clientX-a)<10&&Math.abs(n.clientY-o)<10){const a=$(this);a.is(s)?a.parent().toggleClass("row-active"):(s&&s.parent().removeClass("row-active"),a.parent().addClass("row-active")),$(window).width()<768&&e.scrollLeft(e.scrollLeft()+t.first().position().left),s=a}i=!1})).on("mousedown",(function(e){i=!0,a=e.clientX,o=e.clientY}))}class k_Table{constructor(e,t=null,s=30){this.table=$(e),this.tableBody=this.table.find("table").first().append("<tbody/>"),this.paginationInfo=$("<span/>").addClass("k-table-pagination-info"),this.paginationButtons=$("<div/>").addClass("k-table-pagination-buttons"),$("<div/>").addClass("k-table-pagination").append(this.paginationInfo).append(this.paginationButtons).insertBefore($(e)),this.container=this.table.parent(),this.horizontalScroll=$("<div/>").addClass("k-table-horizontal-scroll").insertAfter($(e));const a=$("<div/>").width($(e).find("table").width()).height(1).appendTo(this.horizontalScroll);if(this.setScrollPosition=()=>{if(this.container[0].scrollHeight-this.container[0].clientHeight>1){const e=this.table.scrollLeft();this.horizontalScroll.scrollLeft(e),this.horizontalScroll.show()}else this.horizontalScroll.hide();const t=this.container.scrollTop()+this.container.height()-this.horizontalScroll.height();this.horizontalScroll.css("top",t),a.width($(e).find("table").width())},this.setScrollPosition(),$(window).on("resize",this.setScrollPosition),this.table.parent().on("scroll",this.setScrollPosition),this.horizontalScroll.on("scroll",()=>{const e=this.horizontalScroll.scrollLeft();this.table.scrollLeft(e)}),$("<button/>").addClass("k-btn k-btn-light").hide().appendTo(this.paginationButtons).click(()=>this.goToPage(1)).text(1),$("<span/>").text("...").hide().appendTo(this.paginationButtons),$("<button/>").addClass("k-btn k-btn-light").hide().appendTo(this.paginationButtons),$("<button/>").addClass("k-btn k-btn-light").hide().appendTo(this.paginationButtons),$("<button/>").addClass("k-btn k-btn-light").hide().appendTo(this.paginationButtons),$("<span/>").text("...").hide().appendTo(this.paginationButtons),$("<button/>").addClass("k-btn k-btn-light").hide().appendTo(this.paginationButtons).click(()=>this.goToPage(this.pagesCount)),this.rowsPerPage=s,this.rows=[],this.data=[],this.filteredData=[],t)for(let e=0;e<s;e++){const s=$(t).clone(!1).hide().appendTo(this.tableBody);e%2==0&&s.addClass("k-table-row-even"),this.rows.push(s)}else{var o=$(e).find("thead tr").first().children().length;for(let e=0;e<s;e++){const t=$("<tr/>").hide().appendTo(this.tableBody);for(var i=0;i<o;i++)$("<td/>").appendTo(t);e%2==0&&t.addClass("k-table-row-even"),this.rows.push(t)}}this.rowFactory=(e,t)=>{}}setData(e){if(!(e instanceof Array))throw new Error("Array expected, get "+typeof e);return this.data=e,this.dataCount=e.length,this}setRowFactory(e){if("function"!=typeof e)throw new Error("Argument is not a function.");return this.rowFactory=e,this}setSortFunction(e){if("function"!=typeof e)throw new Error("Argument is not a function.");return this.defaultSortFunction=e,this}filter(e=null,t=null){if(e&&e.length>0?this.filteredData=this.data.filter(t=>e.every(e=>e(t))):this.filteredData=this.data,t){if("function"!=typeof t)throw new Error("Argument is not a function.");this.filteredData.sort(t)}else this.defaultSortFunction&&this.filteredData.sort(this.defaultSortFunction);return this.pagesCount=Math.ceil(this.filteredData.length/this.rowsPerPage),this.pagesCount>=1?(this.currentPage=-1,this.goToPage(1)):(this.rows.forEach(e=>{e.hide()}),this.paginationButtons.children().hide(),this.paginationInfo.text("Brak danych / rezultatów filtrowania")),this}goToPage(e){if(e!=this.currentPage){if(e<1||e>this.pagesCount)throw new Error("Page "+e+"is out of bounds [1 : "+this.pagesCount+"]");this.currentPage=e,this.table.parent().scrollTop(0),this.rows.forEach(e=>{e.hide()});for(var t=this.filteredData.length,s=(e-1)*this.rowsPerPage,a=Math.min(s+this.rowsPerPage,t),o=s;o<a;o++)this.rowFactory(this.rows[o-s].show(),this.filteredData[o]);return this.paginationInfo.text("Wyświetlanie "+Math.min(a-s,this.rowsPerPage)+" pozycji z "+this.dataCount+" łącznie"),this.paginationButtons.children().hide().addClass("k-btn-light"),this.pagesCount<=3?2==this.pagesCount?(this.paginationButtons.children().eq(0).show(),this.paginationButtons.children().eq(6).show().text(this.pagesCount),1==e?this.paginationButtons.children().eq(0).removeClass("k-btn-light"):this.paginationButtons.children().eq(6).removeClass("k-btn-light")):3==this.pagesCount&&(this.paginationButtons.children().eq(0).show(),this.paginationButtons.children().eq(2).show().text(2).unbind("click").click(()=>this.goToPage(2)),this.paginationButtons.children().eq(6).show().text(this.pagesCount),1==e?this.paginationButtons.children().eq(0).removeClass("k-btn-light"):2==e?this.paginationButtons.children().eq(2).removeClass("k-btn-light"):this.paginationButtons.children().eq(6).removeClass("k-btn-light")):(this.paginationButtons.children().eq(0).show(),this.paginationButtons.children().eq(6).show().text(this.pagesCount),e<3?(this.paginationButtons.children().eq(2).show().text(2).unbind("click").click(()=>this.goToPage(2)),this.paginationButtons.children().eq(3).show().text(3).unbind("click").click(()=>this.goToPage(3)),this.paginationButtons.children().eq(5).show(),1==e?this.paginationButtons.children().eq(0).removeClass("k-btn-light"):this.paginationButtons.children().eq(2).removeClass("k-btn-light")):this.pagesCount-e<2?(this.paginationButtons.children().eq(1).show(),this.paginationButtons.children().eq(3).show().text(this.pagesCount-2).unbind("click").click(()=>this.goToPage(this.pagesCount-2)),this.paginationButtons.children().eq(4).show().text(this.pagesCount-1).unbind("click").click(()=>this.goToPage(this.pagesCount-1)),e==this.pagesCount-1?this.paginationButtons.children().eq(4).removeClass("k-btn-light"):e==this.pagesCount&&this.paginationButtons.children().eq(6).removeClass("k-btn-light")):(this.paginationButtons.children().eq(1).show(),this.paginationButtons.children().eq(2).show().text("<").unbind("click").click(()=>this.goToPage(e-1)),this.paginationButtons.children().eq(3).show().text(e).unbind("click").removeClass("k-btn-light"),this.paginationButtons.children().eq(4).show().text(">").unbind("click").click(()=>this.goToPage(e+1)),this.paginationButtons.children().eq(5).show())),this.setScrollPosition(),this}}}function initProjectsTable(e){const t=$("#project-search-input"),s=new k_Select({selectDiv:"#activity-select",placeholder:"Aktywność",multiple:!0,hideOnSelect:!1,options:[{value:"t",text:"Aktywny"},{value:"f",text:"Zakończony"}]}),a=new k_Select({selectDiv:"#sortBy-select",placeholder:"Sortowanie",multiple:!1,hideOnSelect:!0,options:[{value:1,text:"Aktywność aktywny - zakończony"},{value:2,text:"Aktywność zakończony - aktywny"}]}),o=function(e,t){return("t"==t[2]?1:0)-("t"==e[2]?1:0)},i=function(e,t){return("t"==e[2]?1:0)-("t"==t[2]?1:0)},n=e=>e[1].toLowerCase().indexOf(t.val().toLowerCase())>-1,l=e=>{const t=e[2],a=s.selectedOptions.length;for(let e=0;e<a;e++)if(t==s.selectedOptions[e].value)return!0;return!1},d=$("<tr/>").append($("<td/>").append($("<a/>").addClass("k-table-action-icon").append($("<i/>").addClass("icon-pencil")))).append($("<td/>")).append($("<td/>").append($("<span/>").addClass("k-table-badge"))).append($("<td/>").addClass("overflow-ellipsis").append($("<span/>"))),r=new k_Table("#projects-table",d).setRowFactory((e,t)=>{const s=e.children(),a="k-table-badge "+("t"==t[2]?"k-table-badge-in-progress":"k-table-badge-finished"),o="t"==t[2]?"Aktywny":"Zakończony";s.eq(0).children().first().removeAttr("href").attr("href","edit_project.php?projekt="+t[0]),s.eq(1).text(t[0]),s.eq(2).children().first().removeClass().addClass(a).text(o),s.eq(3).children().first().text(t[1])});$("#filter-btn").on("click",()=>{const e=[];if(t.val()&&e.push(n),s.selectedOptions.length>0&&e.push(l),a.selectedOptions.length>0){const t=a.selectedOptions[0];if(1==t.value)r.filter(e,o);else{if(2!=t.value)throw new Error("Unknown select value");r.filter(e,i)}}else r.filter(e,o)}),r.setData(e),r.filter(null,o),expandableRows($("#projects-table"))}function initTasksTable(e,t,s){const a=$("#task-id-input"),o=new k_Select({selectDiv:"#status-select",placeholder:"Status",multiple:!0,hideOnSelect:!1,options:[{value:"n",text:"Nowe"},{value:"r",text:"W realizacji"},{value:"e",text:"Zakończone"},{value:"c",text:"Anulowane"}]}),i=new k_Select({selectDiv:"#assignedBy-select",placeholder:"Os. zlecająca",multiple:!0,searchField:"Szukaj",hideOnSelect:!1}),n=new k_Select({selectDiv:"#assignedTo-select",placeholder:"Os. odpowiedzialna",multiple:!0,searchField:"Szukaj",hideOnSelect:!1}),l=new k_Select({selectDiv:"#sortBy-select",placeholder:"Sortowanie",multiple:!1,options:[{value:1,text:"Status Nowe - Anulowane"},{value:2,text:"Data utworzenia malejąco"},{value:3,text:"Data utworzenia rosnąco"},{value:4,text:"Termin realizacji malejąco"},{value:5,text:"Termin realizacji rosnąco"}]}),d=function(e,t){return t[7]-e[7]},r=new Map;r.set("n",4),r.set("r",3),r.set("e",2),r.set("c",1);const c=new Map;c.set(l.options[0].text.toLowerCase(),(function(e,t){return r.get(t[0])-r.get(e[0])||t[10]-e[10]})),c.set(l.options[1].text.toLowerCase(),d),c.set(l.options[2].text.toLowerCase(),(function(e,t){return e[7]-t[7]})),c.set(l.options[3].text.toLowerCase(),(function(e,t){return t[8]-e[8]})),c.set(l.options[4].text.toLowerCase(),(function(e,t){return e[8]-t[8]}));const h=e=>{const t=e[1].toLowerCase().indexOf(a.val().toLowerCase())>-1,s=e[2].toLowerCase().indexOf(a.val().toLowerCase())>-1;return t||s},p=e=>{const t=e[0].toLowerCase(),s=o.selectedOptions.length;for(let e=0;e<s;e++)if(t==o.selectedOptions[e].value.toLowerCase())return!0;return!1},u=e=>{const t=e[5].toLowerCase(),s=i.selectedOptions.length;for(let e=0;e<s;e++)if(t==i.selectedOptions[e].text.toLowerCase())return!0;return!1},f=e=>{const t=e[6].toLowerCase(),s=n.selectedOptions.length;for(let e=0;e<s;e++)if(t==n.selectedOptions[e].text.toLowerCase())return!0;return!1},g=$("<tr/>").append($("<td/>")).append($("<td/>")).append($("<td/>")).append($("<td/>").addClass("overflow-ellipsis").append($("<span/>"))).append($("<td/>")).append($("<td/>")).append($("<td/>")).append($("<td/>")).append($("<td/>")).append($("<td/>").append($("<span/>").addClass("k-table-badge"))),w=new k_Table("#tasks-table",g).setRowFactory((e,t)=>{e.removeClass("row-active");const s=e.children();switch(t[0].toLowerCase()){case"n":s.eq(9).children().first().removeClass().addClass("k-table-badge k-table-badge-new").text("Nowe");break;case"r":s.eq(9).children().first().removeClass().addClass("k-table-badge k-table-badge-in-progress").text("W realizacji");break;case"e":s.eq(9).children().first().removeClass().addClass("k-table-badge k-table-badge-finished").text("Zakończone");break;case"c":s.eq(9).children().first().removeClass().addClass("k-table-badge k-table-badge-canceled").text("Anulowane")}const a="?projekt="+t[9]+"&zlecenie="+t[10];s.eq(0).empty(),s.eq(0).append($("<a/>").addClass("k-table-action-icon").attr("href",encodeURI("print_task.php"+a+"#view=fitV")).attr("target","_blank").append($("<i/>").addClass("icon-printer"))),s.eq(0).append($("<a/>").addClass("k-table-action-icon").attr("href",encodeURI("info_task.php"+a)).append($("<i/>").addClass("icon-info"))),t[11]&&s.eq(0).append($("<a/>").addClass("k-table-action-icon").attr("href",encodeURI("edit_task.php"+a)).append($("<i/>").addClass("icon-pencil"))),s.eq(1).text(t[1]),s.eq(2).text(t[2]),s.eq(3).children().first().empty().append(t[3]),s.eq(4).text(t[5]),s.eq(5).text(t[6]);const o=t[7];s.eq(6).text(("00"+o.getDate()).slice(-2)+"."+("00"+(o.getMonth()+1)).slice(-2)+"."+o.getFullYear()+", "+("00"+o.getHours()).slice(-2)+":"+("00"+o.getMinutes()).slice(-2));const i=t[8];s.eq(7).text(("00"+i.getDate()).slice(-2)+"."+("00"+(i.getMonth()+1)).slice(-2)+"."+i.getFullYear()).removeClass("date-alert"),new Date-i>=0&&("n"!=t[0].toLowerCase()&&"r"!=t[0].toLowerCase()||s.eq(7).addClass("date-alert")),s.eq(8).text(t[4])});$("#filter-btn").on("click",()=>{const e=[];a.val()&&e.push(h),o.selectedOptions.length>0&&e.push(p),i.selectedOptions.length>0&&e.push(u),n.selectedOptions.length>0&&e.push(f),l.selectedOptions.length?w.filter(e,c.get(l.selectedOptions[0].text.toLowerCase())):w.filter(e,d),$.ajax({url:"../ajax/save_task_filters.php",type:"POST",data:{task_filters:{input:a.val(),status:o.selectedOptions.map(e=>e.text),assignedBy:i.selectedOptions.map(e=>e.text),assignedTo:n.selectedOptions.map(e=>e.text),sortBy:l.selectedOptions.map(e=>e.text)}}})});const C=[],k=[];if(e.forEach(e=>{e[5]=0!=e[5].trim().length?e[5]:"[nie podano]",e[6]=0!=e[6].trim().length?e[6]:"[nie podano]",e[7]=new Date(e[7]),e[8]=new Date(e[8]),C.push(e[5]),k.push(e[6])}),i.setOptions(Array.from(new Set(C))),n.setOptions(Array.from(new Set(k))),w.setData(e),s){const e=[];s.input&&(a.val(s.input),e.push(h)),s.status&&(o.options.forEach(e=>{s.status.includes(e.text)&&e.select()}),o.selectedOptions.length>0&&e.push(p)),s.assignedBy&&(i.options.forEach(e=>{s.assignedBy.includes(e.text)&&e.select()}),i.selectedOptions.length>0&&e.push(u)),s.assignedTo&&(n.options.forEach(e=>{s.assignedTo.includes(e.text)&&e.select()}),n.selectedOptions.length>0&&e.push(f)),s.sortBy&&l.options.forEach(e=>{s.sortBy==e.text&&e.select()});const t=l.selectedOptions.length?c.get(l.selectedOptions[0].text.toLowerCase()):d;w.filter(e,t)}else w.filter(null,d);expandableRows($("#tasks-table"))}function initUsersTable(e){const t=$("#user-search-input"),s=new k_Select({selectDiv:"#role-select",placeholder:"Grupa",multiple:!0,hideOnSelect:!1,options:[{value:"c",text:"Klient"},{value:"e",text:"Pracownik"},{value:"a",text:"Administrator"}]}),a=new k_Select({selectDiv:"#sortBy-select",placeholder:"Sortowanie",multiple:!1,hideOnSelect:!0,options:[{value:1,text:"Grupa klient - administrator"},{value:2,text:"Grupa administrator - klient"},{value:3,text:"Data utworzenia malejąco"},{value:4,text:"Data utworzenia rosnąco"}]}),o=new Map;o.set("a",1),o.set("e",2),o.set("c",3);const i=function(e,t){return o.get(t[9])-o.get(e[9])||t[0]-e[0]},n=new Map;n.set(a.options[0].text.toLowerCase(),i),n.set(a.options[1].text.toLowerCase(),(function(e,t){return o.get(e[9])-o.get(t[9])||t[0]-e[0]})),n.set(a.options[2].text.toLowerCase(),(function(e,t){return new Date(t[10])-new Date(e[10])||t[0]-e[0]})),n.set(a.options[3].text.toLowerCase(),(function(e,t){return new Date(e[10])-new Date(t[10])||e[0]-t[0]}));const l=e=>{const s=t.val().toLowerCase().split(" ");for(const t of s)if(e[1].toLowerCase().indexOf(t)>-1||e[2].toLowerCase().indexOf(t)>-1||e[3].toLowerCase().indexOf(t)>-1)return!0;return!1},d=e=>{const t=e[9],a=s.selectedOptions.length;for(let e=0;e<a;e++)if(t==s.selectedOptions[e].value)return!0;return!1},r=$("<tr/>").append($("<td/>")).append($("<td/>")).append($("<td/>").append($("<span/>").addClass("k-table-badge"))).append($("<td/>")).append($("<td/>")).append($("<td/>")).append($("<td/>").addClass("overflow-ellipsis").append($("<span/>"))).append($("<td/>")),c=new k_Table("#users-table",r).setRowFactory((e,t)=>{const s=e.children(),a=$("<i/>").addClass("icon-bin").addClass("k-table-action-icon").click(()=>{(new Alert).setTitle("Usuwanie konta").setMessage("Czy napewno chcesz usunąć konto użytkownika <b>"+t[1]+" "+t[2]+"</b>? Operacja jest nieodwracalna!").option((function(){window.location.href="../connection/database/query/deleteUser.php?id_user="+t[0]}))});switch(s.eq(0).empty().append(a).append($("<a/>").addClass("k-table-action-icon").attr("href","edit_user.php?uzytkownik="+t[0]).append($("<i/>").addClass("icon-pencil"))),s.eq(1).text(t[0]),t[9].toLowerCase()){case"c":s.eq(2).children().first().removeClass().addClass("k-table-badge client").text("Klient");break;case"e":s.eq(2).children().first().removeClass().addClass("k-table-badge employee").text("Pracownik");break;case"a":s.eq(2).children().first().removeClass().addClass("k-table-badge admin").text("Administrator")}s.eq(3).text(t[1]),s.eq(4).text(t[2]),s.eq(5).text(t[3]);let o=t[4];"?"!=t[5]&&(o+=" ; "+t[5]),"?"!=t[6]&&(o+=" ; "+t[6]),"?"!=t[7]&&(o+=" ; "+t[7]),"?"!=t[8]&&(o+=" ; "+t[8]),s.eq(6).children().first().text(o);const i=new Date(t[10]);s.eq(7).text(("00"+i.getDate()).slice(-2)+"."+("00"+(i.getMonth()+1)).slice(-2)+"."+i.getFullYear())});$("#filter-btn").on("click",()=>{const e=[];t.val()&&e.push(l),s.selectedOptions.length>0&&e.push(d),a.selectedOptions.length>0?c.filter(e,n.get(a.selectedOptions[0].text.toLowerCase())):c.filter(e,i)}),c.setData(e),c.filter(null,i),expandableRows($("#users-table"))}